/*
	S26.US11	ICHCAHPS submission file changes
		as an authorized ICHCAHPS vendor, we must remove records from the submission file that were sampled in error


	T11.5	create a 'CMS Removal' disposition and put it at the top of ICHCAHPS' hierarchy

Dave Gilsdorf

QP_Prod:
INSERT INTO dbo.Disposition
UPDATE/INSERT INTO SurveyTypeDispositions 
DELETE FROM ScheduledMailing (stage environment only)
INSERT INTO dbo.DispositionLog
*/
use qp_prod
go
/* create new disposition code -- double-check that the new code is '48' -- if not, update the catalyst script */
if not exists (select * from disposition where strDispositionLabel='CMS Removal')
	insert into disposition (strDispositionLabel,Action_id,strReportLabel,MustHaveResults) 
	values ('CMS Removal',0,'CMS Removal',0)
go

/* put the new code at the top of ICHCAHPS' heirarcy */
if not exists (select * from SurveyTypeDispositions where [desc]='CMS Removal' and SurveyType_id=8)
begin
	update SurveyTypeDispositions set Hierarchy=Hierarchy+1 where surveytype_id=8
	insert into SurveyTypeDispositions (Disposition_ID,Value,Hierarchy,[Desc],ExportReportResponses,ReceiptType_ID,SurveyType_ID)
	select Disposition_id, 999 as Value, 0 as Hierarchy, strDispositionLabel as [Desc],0 as ExportReportResponses,null as ReceiptType_ID,8 as SurveyType_ID
	from Disposition 
	where strDispositionLabel='CMS Removal'
end

/* stage only: remove the samplepops from scheduledmailing, etc. */
if exists (select * from qualpro_params where strParam_nm ='EnvName' and STRPARAM_VALUE='STAGING')
	delete 
	from SCHEDULEDMAILING 
	where SAMPLEPOP_ID in (113515173,113515177,113515146,113522108,113522192,113522078,113522147,113522069,113522132,113522106,113522112,113522182,113522054,113522064,113522086,113522103
		,113522138,113522196,113522161,113522191,113522125,113522171,113522117,113522144,113522648,113597976,113597972,113538651,113538600,113541122,113541315,113541117,113541305,113541271
		,113541274,113541254,113542581,113533777,113533729,113533738,113533776,113533756,113533762,113552174,113552149,113552244,113552231,113552334,113552633,113552444,113552402,113552448
		,113552368,113552319,113552743,113552749,113552723,113552707,113552710,113552713,113552756,113552768,113552825,113552821,113552762,113552773,113552765,113552819,113552757,113552837
		,113552814,113552801,113552782,113552753,113552817,113552783,113552813,113552795,113552769,113552799,113552839,113552869,113552864,113614564,113553594,113553580,113553527,113553533
		,113553576,113553615,113553623,113553724,113553643,113553675,113553699,113553756,113553799,113553753,113553803,113553649,113553728,113553813,113553857,113553850,113553844,113553847
		,113553842,113553841,113553815,113551041,113551187,113551129,113551167,113599760,113599735,113599752,113599729,113599755,113599732,113599747,113599753,113599731,113599743,113599764
		,113599771,113599768,113599739,113599749,113599761,113599746,113599766,113599740,113599767,113599736,113599757,113599745,113599751,113531144,113552562,113552598,113552328,113552483
		,113552636,113552670,113552573,113552359,113537427,113537429,113552534,113553968,113553987,113542547) 
	and SENTMAIL_ID is null 


/* insert records in DispositionLog for the appropriate samplepops */
insert into dispositionlog (samplepop_id, Disposition_id,ReceiptType_id,datLogged,LoggedBy)
select sp.Samplepop_id, d.Disposition_id, 0 as receiptType_id, getdate() as datLogged, 'CMS Removal' as LoggedBy 
from samplepop sp, disposition d
where d.strDispositionLabel='CMS Removal'
and sp.SAMPLEPOP_ID in (113515173,113515177,113515146,113522108,113522192,113522078,113522147,113522069,113522132,113522106,113522112,113522182,113522054,113522064,113522086,113522103
	,113522138,113522196,113522161,113522191,113522125,113522171,113522117,113522144,113522648,113597976,113597972,113538651,113538600,113541122,113541315,113541117,113541305,113541271
	,113541274,113541254,113542581,113533777,113533729,113533738,113533776,113533756,113533762,113552174,113552149,113552244,113552231,113552334,113552633,113552444,113552402,113552448
	,113552368,113552319,113552743,113552749,113552723,113552707,113552710,113552713,113552756,113552768,113552825,113552821,113552762,113552773,113552765,113552819,113552757,113552837
	,113552814,113552801,113552782,113552753,113552817,113552783,113552813,113552795,113552769,113552799,113552839,113552869,113552864,113614564,113553594,113553580,113553527,113553533
	,113553576,113553615,113553623,113553724,113553643,113553675,113553699,113553756,113553799,113553753,113553803,113553649,113553728,113553813,113553857,113553850,113553844,113553847
	,113553842,113553841,113553815,113551041,113551187,113551129,113551167,113599760,113599735,113599752,113599729,113599755,113599732,113599747,113599753,113599731,113599743,113599764
	,113599771,113599768,113599739,113599749,113599761,113599746,113599766,113599740,113599767,113599736,113599757,113599745,113599751,113531144,113552562,113552598,113552328,113552483
	,113552636,113552670,113552573,113552359,113537427,113537429,113552534,113553968,113553987,113542547) 
