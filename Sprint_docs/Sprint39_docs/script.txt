USE [QP_Prod]
GO


select distinct qf.*
into temp_QuestionFormMissingDatreturned
from QuestionForm qf
inner join sentmailing sm on qf.sentmail_id=sm.sentmail_id
--left join scanningresets sr on sr.strLithoCode = sm.strLithocode
--left join Questionform_Missing_datReturned qfmr on qfmr.QuestionForm_id = qf.QuestionForm_id and qfmr.program_name='SQLAgent - TSQL JobStep (Job 0x40D7E91D87EAD544B986C72062EBD847 : Step 7)'
inner join Survey_def sd on qf.Survey_id=sd.Survey_id
inner join SurveyType st on sd.Surveytype_id=st.Surveytype_id
inner join SAMPLEPOP sp on sp.SAMPLEPOP_ID = qf.SAMPLEPOP_ID
inner join SELECTEDSAMPLE ss on ss.SAMPLESET_ID = sp.SAMPLESET_ID and ss.pop_id = sp.pop_id
where qf.DATRETURNED is null 
and qf.datUnusedReturn is null 
and qf.UnusedReturn_id <> 6
and (qf.strScanBatch is not null and LEN(qf.strScanBatch) > 0)
and st.Surveytype_dsc in ('ICHCAHPS','Home Health CAHPS')
--and qfmr.QuestionForm_id is null -- excluding those problem questionforms captured in logging
--and sr.strLithoCode is null
and ss.SampleEncounterDate between '12-01-2014' and '06-30-2015' -- 1st & 2nd quarter
and sm.datExpire < GetDATE()
